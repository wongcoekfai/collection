<!DOCTYPE html>
<html class="pixel-ratio-2 retina android android-6 android-6-0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>患者信息</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
                <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="author" content="">
    <link rel="shortcut icon" href="http://staticcdn2.zhongtuobang.com/img/ico/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">

    <!-- Standard iPhone -->
    <link rel="apple-touch-icon" sizes="57x57" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Retina iPhone -->
    <link rel="apple-touch-icon" sizes="114x114" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Standard iPad -->
    <link rel="apple-touch-icon" sizes="72x72" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Retina iPad -->
    <link rel="apple-touch-icon" sizes="144x144" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">

    <!-- SUI CSS -->
    <link href="css/start/sm.min.css" rel="stylesheet">
    <link href="css/start/sm-extend.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/start/ztb-wx-common.css" rel="stylesheet">

    <!-- Bbc CSS -->
    <link href="css/start/ztb-wx-bbc.css" rel="stylesheet">

    <!-- viewer CSS -->
    <link href="css/start/viewer.min.css" rel="stylesheet">

    <!-- animate CSS -->
    <link href="css/start/animate.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="css/start/font-awesome.min.css" rel="stylesheet">

    <!-- SUI JS -->
    <script src="js/start/hm.js"></script><script src="js/start/zepto.min.js"></script>

    <!-- viewer JS -->
    <script src="js/start/viewer.min.js"></script>


    <!-- Custom JS -->
    <script src="js/start/ztb-wx-common.js"></script>
    <!-- Bbc JS -->
    <script src="js/start/ztb-wx-bbc.js"></script>

</head>

<body>
    <div class="page-group">
            
<script src="js/start/jquery-1.11.0.js"></script>
<link rel="stylesheet" href="css/start/webuploader.css">
<link rel="stylesheet" href="css/start/create2.css">
<script src="js/start/webuploader.js"></script>

<form enctype="multipart/form-data" id="bbc-form" action="#" method="post"><div class="bbc2-top1">
  <img src="images/bbc2-top1.png" alt="" width="5%" style="vertical-align: text-bottom">
  <span>以下信息(姓名除外)，仅用于平台审核，不对外公开</span>
</div>
<div>
  <div class="content" style="overflow-x: hidden">
    <div class="list-block" style="margin-top:1.5rem;margin-bottom:0">
      <ul>
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title">
                <img class="list-title-icon" src="images/bbc2-create3-icon1.png" alt="" width="14px">
                <span class="list-title-font">患者信息</span>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title label font-16">真实姓名</div>
              <div class="item-input">
                                <input class="font-16 createSubmit" type="text" placeholder="填写受助人真实姓名" id="Bbc_supportName" name="Bbc[supportName]" style="font-size:16px;" value="">
                              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title label font-16">证件类型</div>
              <div class="item-input">
                <label class="label-checkbox">
                  <input type="radio" name="Bbc[cardType]" value="ID" checked="">
                  <div class="item-media idCard" style="display: inline-block;"><i class="icon icon-form-checkbox" style="width: .9rem;height: .9rem;margin-top: -.2rem"></i></div>
                </label>
                <span class="font-16">身份证</span>
                &nbsp;&nbsp;&nbsp;
                <label class="label-checkbox">
                  <input type="radio" name="Bbc[cardType]" value="Birth">
                  <div class="item-media BirthCard" style="display: inline-block;"><i class="icon icon-form-checkbox" style="width: .9rem;height: .9rem;margin-top: -.2rem"></i></div>
                </label>
                <span class="font-16">出生证明</span>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title label font-16 cardInfo">身份证号</div>
              <div class="item-input">
                <input type="text" class="createSubmit" placeholder="填写受助人身份证号码" id="Bbc_supportIdCard" name="Bbc[supportIdCard]" style="font-size:16px;" value="">
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <div class="list-block" style="margin-top:1rem;margin-bottom:0">
      <ul>
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title">
                <img class="list-title-icon" src="images/bbc2-create3-icon4.png" alt="" width="18px">
                <span class="list-title-font supportInfo">患者手持身份证照片</span>
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content">
            <div class="content-padded" style="margin: 0;">
              <div id="uploader-demo">
                <!--用来存放item-->
                <div id="fileList" class="uploader-list">
                  <img class="idCardUpload tjOnClick" tj-data="bbc_click_create2_idsamp" src="images/bbc2-upload-id.png" style="width: 3.8rem;float: left;margin-right: 7px;">
                  <div class="panel-body demo-panel-files" style="display: inline;float: left">
		                                  </div>
                </div>
              </div>
              <!-- /D&D Zone -->
              <div class="panel-body demo-panel-files" id="demo-files1">
              </div>
            </div>
          </div>
        </li>
        <li>
          <div class="item-content">
            <div class="item-inner" style="font-size: 0.8em;color: #666666;">
              <div class="content-padded IdInfo" style="margin: 0rem;">
                <span style="color: #E13A2A;">*</span><span>身份证上的所有信息必须清晰可见。</span><br>
                <span style="color: #E13A2A;">*</span><span>受助人不方便手持，可将身份证放在患者胸前拍照。</span>
              </div>
              <div class="content-padded IdInfo2" style="margin: 0rem;display: none">
                <span style="color: #E13A2A;">*</span><span>若只有户口本没有出生证明，可上传患者户口本个人页并填写身份证件编号。</span><br>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <div class="list-block" style="margin-top:.5rem;margin-bottom:0">
      <ul>
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title label font-14">微信号码</div>
              <div class="item-input">
                <input class="font-14 createSubmit" type="text" placeholder="请填写您的微信号码" id="Bbc_weChatNum" name="Bbc[weChatNum]" style="font-size:14px;" value="">
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>
    
    <div class="row">
      <div class="col-10" style="padding-left: .5rem;margin-top: .55rem;">
        <img src="images/bbc2-question.png" alt="" width="100%">
      </div>
      <div class="col-90" style="margin-left: .5rem;margin-top: .5rem;">
        <span style="font-size: 12px;">若您对填写资料有疑问，请留下您的微信号并提交审核</span>
      </div>
    </div>
    
    <div class="row" style="padding: 1rem">
      <div class="col-100 tjOnClick" tj-data="bbc_click_create2_save" id="btnSubmit">
        <div class="button button-big btnSave">保存</div>
      </div>
      <div class="content-padded col-100" style="text-align:center">
        <span class="font-14"> 筹款遇到问题？微信联系筹款顾问：</span><span style="color:#35A0FB;font-size: .7rem;" class="ztbbc tjOnClick" tj-data="bbc_click_create2_service"></span>
      </div>
    </div>
  </div>
</div>
<div style="display: none;"><img src="images/bbc-up.png" alt=""> <img src="images/bbc-down.png" alt=""> </div>
<div id="mask-id" class="mask hide"></div>
<div id="modals-contain-id" class="modals-contain hide">
  <div class="work-box">
    <div class="upload-cancel">
      <img src="images/bbc2-create3-cancel.png" alt="">
    </div>
    <div class="modals-title">上传图片示例</div>
    <div class="modals-text">
      <div class="row" style="margin-bottom: .5rem;">
        <div class="col-10">
          <span class="spot">•</span>
        </div>
        <div class="col-90" style="margin: 0">
          <span class="text">若患者无法手持证件，可将证件放在患者胸前进行拍照，患者面部要拍全，必须能够看清身份证信息。</span>
        </div>
      </div>
      <img class="sfz" src="images/bbc2-create3-idp.png" alt="" width="100%">
      <img class="cszm hide" src="images/bbc2-create3-csp.png" alt="" width="100%">
      <div style="text-align: center;margin: 5px 0 8px 0;">
        <span class="spot">*</span><span class="text">如有模糊、遮挡，则审核不予通过。</span>
      </div>
      <div id="uploader-demo">
        <!--用来存放item-->
        <div id="filePicker">
          <img src="images/bbc2-create3-button.png" width="100%">
        </div>
      </div>
    </div>
  </div>
</div>
</form><script>

function validateComment(){

  if($("#Bbc_supportName").val()=="0"){
    $.toast("请填写受助人姓名");
    return false;
  }
  if($("#Bbc_supportIdCard").val()==""){
    $.toast("请填写受助人身份证");
    return false;
  }

  //检查受助人身份证照片
  var hasPhoto1;
  $.ajax({
    url: '/bbc/hasPhoto',
    async: false,
    type: 'GET',
    dataType: 'json',
    data: {'id': 7910,'picType': 2},
    success: function(result) {
      hasPhoto1 = result;
    }
  });
   if(hasPhoto1==false){
     $.toast("请添加身份证照片");
     return false;
   }
  
  // if(hasPhoto2==false){
  //   alert("请添加医疗证明照片");
  //   return false;
  // }


  return true;
}

$('#btnSubmit').click(function () {

  if(validateComment()){
//    $(this).attr("class","button button-big button-fill button-round button-light");
    $(this).closest('form').submit();
  }

});

var subtitle = "患者信息";
$("a").each(function(){
  var v = $(this).attr("href");
  if(v.indexOf("javascript")==0){
  }
  else if(v.indexOf("#")==0){
  }
  else if(v.indexOf("tel")==0){
  }
  else if(v.indexOf("back=")>0){
  }
  else if(v.indexOf("?")>0){
    $(this).attr("href",v+"&back="+subtitle);
  }
  else{
    $(this).attr("href",v+"?back="+subtitle);
  }
});
$.noConflict();

$(function () {
  //$.init();

});

$('.idCard').on('click',function () {
  $('.cardInfo').html('身份证号');
  $('.supportInfo').html('患者手持身份证照片');
  $('.IdInfo').css('display','block');
  $('.IdInfo2').css('display','none');
  $('.cszm').addClass('hide');
  $('.sfz').removeClass('hide');
  $('.idCardUpload').attr('tj-data','bbc_click_create2_idsamp');
  $('#Bbc_supportIdCard').attr('placeholder','请填写受助人身份证号');
  $('.idCardUpload').attr('src','https://staticcdn2.zhongtuobang.com/img/bbc2/bbc2-upload-id.png');
  
});
$('.BirthCard').on('click',function () {
  $('.cardInfo').html('出生证编号');
  $('.supportInfo').html('患者出生证明照片');
  $('.IdInfo2').css('display','block');
  $('.IdInfo').css('display','none');
  $('.sfz').addClass('hide');
  $('.cszm').removeClass('hide');
  $('.idCardUpload').attr('tj-data','bbc_click_create2_birthsamp');
  $('#Bbc_supportIdCard').attr('placeholder','请填写受助人出生证编号');
  $('.idCardUpload').attr('src','https://staticcdn2.zhongtuobang.com/img/bbc2/bbc2-create3-cszm.png');
});

</script>

<script type="text/javascript">
  //******************************删除图片******************************//
  $('.cancel').live('click',function () {
      var bbcvideoID = $(this).attr('imageid');
      var _this = jQuery(this);
      $.ajax({
          url:'/bbc/deleteImg',
          data:{'bbcimageID':bbcvideoID},
          type:'POST',
          success:function (data) {
              _this.parent().remove();
              $.toast('文件删除成功');
              var dataObj=eval("("+data+")");
              $(".cancel[imageid='"+dataObj.mainImgID+"']").prev().html('分享封面图');
              console.log(parseInt(_this.parent().attr('id').replace(/[^0-9]/ig,"")));
              if(_this.attr('imageType') == 'idCard'){
                  console.log('看得懂？！');
                  uploader_1.removeFile(_this.parent().attr('id'),true);
              }
              
          },
          error:function (data) {
              $.toast('文件删除失败');
          }
      })
  });
  $('.reloadCancel').on('click',function () {
      var bbcvideoID = $(this).prev().attr('id');
      var _this = $(this);
      $.ajax({
          url:'/bbc/deleteImg',
          data:{'bbcimageID':bbcvideoID},
          type:'POST',
          success:function (data) {
              _this.parent().remove();
              $.toast('文件删除成功');

          },
          error:function (data) {
              $.toast('文件删除失败');
          }
      })
  });
  
</script>

<script type="text/javascript">
    $('.ztbbc').on('click',function () {
        dialog = $.modal({
            text: '<p style="margin-top:.5em;font-size: ;color:#999999;">长按识别二维码，添加微信客服</p><div><img class="closeAlert" src="https://staticcdn2.zhongtuobang.com/img/bbc2/bbc2-ztbbc.png" width="100%"></div>',
        });
        $('.modal-inner').css({'padding-top':'.5em','background':'#fff'});
        $('.modal-in').css('margin-top',' -150px;');
        $('.closeAlert').click(function(){
            $.closeModal(dialog);
        });
    });
    $('.idCardUpload').on('click',function () {
      if(imgNumLimit(1,'idCard') == true){
        return false;
      }
      //####****************************上传身份证图片******************************####//
      var _WebUpload = jQuery,
        $list = _WebUpload('#fileList'),
        // 优化retina, 在retina下这个值是2
        ratio = window.devicePixelRatio || 1,

        // 缩略图大小
        thumbnailWidth = 100 * ratio,
        thumbnailHeight = 100 * ratio,

        // Web Uploader实例
        uploader_1;//上传受助人图片
      // 初始化Web Uploader
      uploader_1 = WebUploader.create({

        // 自动上传。
        auto: true,
        // 文件接收服务端。
        server: '/bbc/fileupload',

        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: {
          id:'#filePicker',
          multiple:true,
        },
        duplicate:true,
        threads:1,
        fileNumLimit:1,
        formData:{
          bbcID: 7910,
          imageType: 2,//上传身份证图片
        },
        // 只允许选择文件，可选。
        accept: {
          title: 'Images',
          extensions: 'gif,jpg,jpeg,bmp,png',
//          mimeTypes: 'image/*,text/plain,application/msword,application/octet-stream,application/vnd.ms-excel,application/x-shockwave-flash'
        }
      });

      // 当有文件添加进来的时候
      uploader_1.on( 'fileQueued', function( file ) {
        $(".mask").addClass("hide");
        $("#modals-contain-id").addClass("hide");
        var $li = _WebUpload(
            '<div id="' + file.id + '" class="file-item thumbnail">' +
            '<img>' +
            '<div class="info">' + file.name + '</div>' +
            '<div class="cancel" imageType="idCard">'+
            '<img src="https://staticcdn2.zhongtuobang.com/img/bbc2/bbc2-delete.png" alt="" width="100%"></div>'
          ),
          $img = $li.find('img').first();

        $list.append($li);

        // 创建缩略图
        uploader_1.makeThumb( file, function( error, src ) {
          if ( error ) {
            $img.replaceWith('<span>不能预览</span>');
            return;
          }

          $img.attr( 'src', src );
        }, thumbnailWidth, thumbnailHeight );
      });

      // 文件上传过程中创建进度条实时显示。
      uploader_1.on( 'uploadProgress', function( file, percentage ) {
        var $li = _WebUpload( '#'+file.id ),
          $percent = $li.find('.progress span');

        // 避免重复创建
        if ( !$percent.length ) {
          $percent = _WebUpload('<p class="progress"><span></span></p>')
            .appendTo( $li )
            .find('span');
        }

        $percent.css( 'width', percentage * 100 + '%' );
      });

      // 文件上传成功，给item添加成功class, 用样式标记上传成功。
      uploader_1.on( 'uploadSuccess', function( file , response) {
        _WebUpload( '#'+file.id ).addClass('upload-state-done');
        _WebUpload( '#'+file.id ).children().filter('.cancel').attr('imageid',response.bbcImageID);
        if(response.type == '0'){
          _WebUpload( '#'+file.id ).find('.info').html('分享封面图');
        }
        if(response.success == false){
          _WebUpload( '#'+file.id ).remove();
          $.toast(response.message);
        }
      });

      // 文件上传失败，现实上传出错。
      uploader_1.on( 'uploadError', function( file ) {
        var $li = _WebUpload( '#'+file.id ),
          $error = $li.find('div.error');

        // 避免重复创建
        if ( !$error.length ) {
          $error = _WebUpload('<div class="error"></div>').appendTo( $li );
        }

        $error.text('上传失败');
      });
      uploader_1.on('error',function (resule) {
        if(resule == 'Q_EXCEED_NUM_LIMIT'){
          $.toast('超出图片上传限制！');
          return false;
        }
      })
      // 完成上传完了，成功或者失败，先删除进度条。
      uploader_1.on( 'uploadComplete', function( file ) {
        _WebUpload( '#'+file.id ).find('.progress').remove();
      });
      $(".mask").removeClass("hide");
      $("#modals-contain-id").removeClass("hide");
      $(".upload-cancel").on("click",function(){
        $(".mask").addClass("hide");
        $(this).parent().parent().addClass("hide");
      });
    })
    </script>    </div>

    
<script type="text/javascript" src="js/start/sm.min.js"></script>
<script type="text/javascript" src="js/start/sm-extend.min.js"></script>

</body></html>