<!DOCTYPE html>
<html class="pixel-ratio-2 retina android android-6 android-6-0">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>春雨筹</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="">
    <link rel="shortcut icon" href="http://staticcdn2.zhongtuobang.com/img/ico/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">

    <!-- Standard iPhone -->
    <link rel="apple-touch-icon" sizes="57x57" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Retina iPhone -->
    <link rel="apple-touch-icon" sizes="114x114" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Standard iPad -->
    <link rel="apple-touch-icon" sizes="72x72" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Retina iPad -->
    <link rel="apple-touch-icon" sizes="144x144" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">

    <!-- SUI CSS -->
    <link href="css/start/sm.min.css" rel="stylesheet">
    <link href="css/start/sm-extend.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/start/ztb-wx-common.css" rel="stylesheet">

    <!-- Bbc CSS -->
    <link href="css/start/ztb-wx-bbc.css" rel="stylesheet">

    <!-- viewer CSS -->
    <link href="css/start/viewer.min.css" rel="stylesheet">

    <!-- animate CSS -->
    <link href="css/start/animate.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="css/start/font-awesome.min.css" rel="stylesheet">

    <!-- SUI JS -->
    
	<script src="js/start/zepto.min.js"></script>

    <!-- viewer JS -->
    <script src="js/start/viewer.min.js"></script>

    <!-- Custom JS -->
    <script src="js/start/ztb-wx-common.js"></script>
    <!-- Bbc JS -->
    <script src="js/start/ztb-wx-bbc.js"></script>

</head>

<body style="">
    <div class="page-group">
            <form enctype="multipart/form-data" id="bbc-form" action="https://bbc.zhongtuobang.com/bbc/createDaily?bbcID=7910&amp;back=%E6%95%91%E5%8A%A9%E5%A4%A7%E7%97%85%E6%82%A3%E8%80%85-%E5%B8%AE%E5%B8%AE%E7%88%B1%E5%BF%83%E7%AD%B9" method="post"><!-- Uploader CSS -->
<link href="css/start/uploader.css" rel="stylesheet">

<script src="js/start/jquery-1.11.0.js"></script>
<!-- Uploader JavaScript -->
<script src="js/start/demo-preview.js"></script>
<script src="js/start/dmuploader.js"></script>
<!-- Uploader JavaScript -->
<link rel="stylesheet" href="css/start/webuploader.css">
<script src="js/start/webuploader.js"></script>

<div>
  <div class="content">
    <div class="list-block" style="margin: 1rem 0;">
      <ul>
        <li>
          <div class="item-content">
            <div class="item-inner">
                新动态说明
            </div>
          </div>
        </li>
        <li>
          <div class="item-content" style="padding-bottom: 1rem;">
            <div class="item-media"><i class="icon icon-form-comment"></i></div>
            <div class="item-inner" style="margin: 0;">
              <div class="item-input">
                <textarea id="content" placeholder="可在此编辑关于受助人治疗进展或筹款动态的文案说明，限200字以内" name="" style="height: 7rem;background: #F8F8F8;font-size: 16px;color: #999999;margin-top:.5rem"></textarea>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>
    <div class="list-block" style="margin-top: 1rem;margin-bottom: 0;padding-bottom: 2.6rem">
      <ul>
          <li>
              <div class="item-content">
                  <div class="item-inner">
                      筹款进展照片（最多8张）
                  </div>
              </div>
          </li>

          <li>
              <div class="item-content">
                  <div class="item-inner">
                      <div class="item-input" style="padding: .5rem 0;">
                          <div id="uploader-demo">
                              <!--用来存放item-->
                              <div id="fileList" class="uploader-list"></div>
                              <div id="filePicker" class="tjOnClick webuploader-container" tj-data="bbc_click_view_createdaily_uppic"><div class="webuploader-pick">
                                  <img src="images/upload.png" style="width: 4rem;">
                              </div><div id="rt_rt_1c3b6ljv01gq34j01p8s1dvkfrt1" style="position: absolute; overflow: hidden; bottom: auto; right: auto; width: 80px; height: 87px; top: 0px; left: 0px;"><input type="file" name="file" class="webuploader-element-invisible" multiple="multiple" accept=""><label style="opacity: 0; width: 100%; height: 100%; display: block; cursor: pointer; background: rgb(255, 255, 255);"></label></div></div>
                          </div>
                          <div class="panel-body demo-panel-files">
                                                        </div>
                          <div class="panel-body demo-panel-files" id="demo-files1">
                          </div>
                      </div>
                  </div>
              </div>
          </li>

          <li>
              <div class="item-content">
                  <div class="item-inner" style="font-size: .5rem;">
                      <div class="row">
                          <div class="col-10">
                              <img src="images/bbc2-danger.png" alt="" width="40%">
                          </div>
                          <div class="col-90" style="margin-left: -2%">
                              请勿在更新内容中上传 <span style="color: #E13A2A;">支付二维码</span> 或引导用户发微信，支付宝红包，私人账号汇款等信息，一旦发现平台将严肃处理。
                          </div>
                      </div>
                  </div>
              </div>
          </li>
      </ul>
    </div>
  </div>
  <div id="divJoin" class="bar bar-footer" style="background-color:#fff;padding-top: 12px;height: 2.6rem;z-index: 9999;padding: 0;">
    <div class="row">
      <a class="col-100 tjOnClick" tj-data="bbc_click_view_createdaily_submit" href="javascript:;" id="btnSubmit" external="" style="color:#fff; font-size:1.3em"><div class="" style="background-color:#3AA9FB;line-height: 1.8em; font-size:0.9em; text-align:center; height: 2.6rem;padding-top: 9px;">提交</div></a>
    </div>
  </div>
</div>


</form><script>

$.noConflict();
$('#btnSubmit').on('click',function () {
    contant = $('#content').val();
    if(contant == ''){
        $.toast('动态内容不能为空！');
        return false;
    }
    $.ajax({
      type:'post',
      data:{'content':$('#content').val(),'bbcID':7910},
      dataType:'Json',
      url:'/bbc/saveDaily',
      success:function (result) {
          $.toast('发布成功');
          window.location.href = '/bbc/donateView/'+7910;
      },
      error:function () {
        $.toast('发布失败');
      }

    })
})


var subtitle = "发布新动态";
$("a").each(function(){
  var v = $(this).attr("href");
  if(v.indexOf("javascript")==0){
  }
  else if(v.indexOf("#")==0){
  }
  else if(v.indexOf("tel")==0){
  }
  else if(v.indexOf("back=")>0){
  }
  else if(v.indexOf("?")>0){
    $(this).attr("href",v+"&back="+subtitle);
  }
  else{
    $(this).attr("href",v+"?back="+subtitle);
  }
});
$(function () {
  //$.init();
});
</script>

<script type="text/javascript">
    var _WebUpload = jQuery,
        $list = _WebUpload('#fileList'),
        // 优化retina, 在retina下这个值是2
        ratio = window.devicePixelRatio || 1,

        // 缩略图大小
        thumbnailWidth = 100 * ratio,
        thumbnailHeight = 100 * ratio,

        // Web Uploader实例
        uploader_1;//上传动态图片
    // 初始化Web Uploader
    uploader_1 = WebUploader.create({

        // 自动上传。
        auto: true,
        // 文件接收服务端。
        server: '/bbc/fileupload',

        // 选择文件的按钮。可选。
        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: {
            id:'#filePicker',
            multiple:true,
        },
        duplicate:true,
        threads:6,
        fileNumLimit:8,
        formData:{
            bbcID: 7910,
            bbcDailyID: 2298,
            imageType: 'dailyImage',//新动态图片描述
        },
        // 只允许选择文件，可选。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',
//            mimeTypes: 'image/*,text/plain,application/msword,application/octet-stream,application/vnd.ms-excel,application/x-shockwave-flash'
        }
    });

    // 当有文件添加进来的时候
    uploader_1.on( 'fileQueued', function( file ) {
        var $li = _WebUpload(
                '<div id="' + file.id + '" class="file-item thumbnail">' +
                '<img>' +
                '<div class="info">' + file.name + '</div>' +
                '<div class="cancel btn-danger" style="display: inline-block;margin-left: -1rem;margin-top:-2rem;width: 1rem;height: 1rem;text-align: center;position: relative;left: 4px;top: -66px;line-height: .8rem;color: #fff;background: #0894ec;border-radius: .5rem;">x</div></div>'
            ),
            $img = $li.find('img');

        $list.append( $li );

        // 创建缩略图
        uploader_1.makeThumb( file, function( error, src ) {
            if ( error ) {
                $img.replaceWith('<span>不能预览</span>');
                return;
            }

            $img.attr( 'src', src );
        }, thumbnailWidth, thumbnailHeight );
    });

    // 文件上传过程中创建进度条实时显示。
    uploader_1.on( 'uploadProgress', function( file, percentage ) {
        var $li = _WebUpload( '#'+file.id ),
            $percent = $li.find('.progress span');

        // 避免重复创建
        if ( !$percent.length ) {
            $percent = _WebUpload('<p class="progress"><span></span></p>')
                .appendTo( $li )
                .find('span');
        }

        $percent.css( 'width', percentage * 100 + '%' );
    });

    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
    uploader_1.on( 'uploadSuccess', function( file , response) {
        _WebUpload( '#'+file.id ).addClass('upload-state-done');
        _WebUpload( '#'+file.id ).children().filter('.cancel').attr('imageid',response.bbcImageID);
        if(response.type == '0'){
            _WebUpload( '#'+file.id ).find('.info').html('分享封面图');
        }
    });

    // 文件上传失败，现实上传出错。
    uploader_1.on( 'uploadError', function( file ) {
        var $li = _WebUpload( '#'+file.id ),
            $error = $li.find('div.error');

        // 避免重复创建
        if ( !$error.length ) {
            $error = _WebUpload('<div class="error"></div>').appendTo( $li );
        }

        $error.text('上传失败');
    });
    uploader_1.on('error',function (resule) {
        if(resule == 'Q_EXCEED_NUM_LIMIT'){
            $.toast('超出图片上传限制！');
            return false;
        }
    })
    // 完成上传完了，成功或者失败，先删除进度条。
    uploader_1.on( 'uploadComplete', function( file ) {
        _WebUpload( '#'+file.id ).find('.progress').remove();
    });
    
    //删除图片
    $('.cancel').live('click',function () {
        var bbcvideoID = $(this).attr('imageid');
        var _this = $(this);
        $.ajax({
            url:'/bbc/deleteDailyImg',
            data:{'bbcDailyImgID':bbcvideoID},
            type:'POST',
            success:function (data) {
                _this.parent().remove();
                $.toast('文件删除成功');
                var dataObj=eval("("+data+")");
                $(".cancel[imageid='"+dataObj.mainImgID+"']").prev().html('分享封面图');
                console.log(parseInt(_this.parent().attr('id').replace(/[^0-9]/ig,"")));
                uploader_1.removeFile(_this.parent().attr('id'),true);
            },
            error:function (data) {
                $.toast('文件删除失败');
            }
        })
    });
    $('.reloadCancel').on('click',function () {
        var bbcvideoID = $(this).prev().attr('id');
        var _this = $(this);
        $.ajax({
            url:'/bbc/deleteDailyImg',
            data:{'bbcDailyImgID':bbcvideoID},
            type:'POST',
            success:function (data) {
                _this.parent().remove();
                $.toast('文件删除成功');

            },
            error:function (data) {
                $.toast('文件删除失败');
            }
        })
    });
</script>    </div>

<script type="text/javascript" src="js/start/sm.min.js"></script>
<script type="text/javascript" src="js/start/sm-extend.min.js"></script>
</body></html>