<!DOCTYPE html>
<html class="pixel-ratio-2 retina android android-6 android-6-0">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>春雨筹</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="">
    <link rel="shortcut icon" href="http://staticcdn2.zhongtuobang.com/img/ico/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">

    <!-- Standard iPhone -->
    <link rel="apple-touch-icon" sizes="57x57" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Retina iPhone -->
    <link rel="apple-touch-icon" sizes="114x114" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Standard iPad -->
    <link rel="apple-touch-icon" sizes="72x72" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">
    <!-- Retina iPad -->
    <link rel="apple-touch-icon" sizes="144x144" href="http://staticcdn2.zhongtuobang.com/img/ico/touch-icon-114.png">

    <!-- SUI CSS -->
    <link href="css/start/sm.min.css" rel="stylesheet">
    <link href="css/start/sm-extend.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/start/ztb-wx-common.css" rel="stylesheet">

    <!-- Bbc CSS -->
    <link href="css/start/ztb-wx-bbc.css" rel="stylesheet">

    <!-- viewer CSS -->
    <link href="css/start/viewer.min.css" rel="stylesheet">

    <!-- animate CSS -->
    <link href="css/start/animate.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="css/start/font-awesome.min.css" rel="stylesheet">

    <!-- SUI JS -->
    <script src="js/start/zepto.min.js"></script>

    <!-- viewer JS -->
    <script src="js/start/viewer.min.js"></script>

    <!-- Custom JS -->
    <script src="js/start/ztb-wx-common.js"></script>
    <!-- Bbc JS -->
    <script src="js/start/ztb-wx-bbc.js"></script>

</head>

<body>
    <div class="page-group">
            <form enctype="multipart/form-data" id="bbc-form" action="" method="post"><style type="text/css">
  @media (max-width: 320px) {
    .anonymous{
      margin-right:8rem;
    }
    #PingXXComment span{
      font-size: 14px;
    }
  }
  @media (min-width:375px ) {
    .anonymous{
      margin-right:11rem;
    }
    #PingXXComment span{
      font-size: 16px;
    }
    /*.modal{*/
      /*left: 43%;*/
      /*width: 16rem;*/
    /*}*/
  }
  @media (min-width:414px ) {
    .anonymous{
      margin-right:11rem;
    }
    #PingXXComment span{
      font-size: 16px;
    }
  }

</style>

<div>
  <div class="content">
    <div class="row list-block" style="color:#333;background-color: #fff;margin-top: 1rem;margin-bottom: 0;">
      <ul style="">
        <li>
          <div class="item-content">
            <div class="item-inner">
              <div class="item-title"><b>帮助金额</b></div>
            </div>
          </div>
        </li>
      </ul>
      <div class="list-block">
        <input id="Comment_money" name="Comment[money]" type="hidden" value="">
        <div class="recharge clearfix">
          <ul>
            <li>
              <input style="border-radius:0;" type="button" value="10元" id="val_10" name="rec_val" onclick="lovePoint=10+baseLovePoint;changeCur(this.id); pay_money = 10;" class="">
            </li>
            <li>
              <input style="border-radius:0;" type="button" value="30元" id="val_30" name="rec_val" onclick="lovePoint=30+baseLovePoint;changeCur(this.id); pay_money = 30;" class="cur">
            </li>
            <li>
              <input style="border-radius:0;" type="button" value="50元" id="val_50" name="rec_val" onclick="lovePoint=50+baseLovePoint;changeCur(this.id); pay_money = 50;" class="">
            </li>
            <li>
              <input style="border-radius:0;" type="button" value="100元" id="val_100" name="rec_val" onclick="lovePoint=100+baseLovePoint;changeCur(this.id); pay_money = 100;" class="">
            </li>
            <li>
              <input style="border-radius:0;" type="button" value="200元" id="val_200" name="rec_val" onclick="lovePoint=200+baseLovePoint;changeCur(this.id); pay_money = 200;" class="">
            </li>
            <li>
              <input type="text" placeholder="其他金额" id="val_other" name="rec_val" onclick="changeCur(this.id);" onkeyup="pay_money = parseInt($(&#39;#val_other&#39;).val());" class="">
            </li>
          </ul>
        </div>
      </div>
    </div>
<!--    爱心值显示-->
    <div class="row">
      <div class="" style="margin: .6rem .6rem 1rem 1.5rem;background-image: url(&#39;https://staticcdn2.zhongtuobang.com/img/bbc2/bbc2-lovePointBox.png&#39;);background-size: cover;min-height: 40px;max-width: 400px">
        <p style="font-size: .8rem;color:rgb(127,126,127);margin-left:10px;padding-top: 10px;" id="lovePoint">您的爱心值将增加40分。
<a style="text-decoration:underline;color:rgb(53,160,251)" onclick="showInfo()">何为爱心值？</a></p>
      </div>
    </div>
    <div class="row" style="background-color: white;">
      <div class="list-block" style="margin:0;">
        <ul>
          <li style="float:left;">
            <div class="item-content">
              <div class="item-media"><i class="icon icon-form-toggle"></i></div>
              <div class="item-inner">
                <div class="item-input" style="width: 2rem;">
                  <label class="label-checkbox">
                    <input type="checkbox" name="Comment[isAnonymous]" id="comment_isAnonymous">
                    <div class="item-media" style="display: inline-block;"><i class="icon icon-form-checkbox" style="width: 1.2rem;height: 1.2rem;margin-top: -.2rem"></i></div>
                  </label>
                </div>
                <div class="" style="display: inline-block;">
                  匿名支持
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <div>
      <div class="list-block">
        <ul>
          <li>
            <div class="item-content" style="margin-top: -1.5rem;">
              <div class="item-inner">
                <div class="item-input">
                  <textarea id="Comment_comment" name="Comment[comment]" placeholder="说一句鼓励Ta的话吧~" style="height:5rem"></textarea>
                </div>
              </div>
            </div>
          </li>
        </ul>
                  <div class="row" style="padding: 1rem">
            <div class="col-100 tjOnClick" tj-data="bbc_click_donate_elsepay" id="PingXXComment">
              <img src="images/bbc2-webpay.png" alt="" width="100%">
            </div>
          </div>
              </div>
    </div>
    <div class="row" style="font-size:0.8em;text-align:center;color:#3d4145;margin-top:;margin-left:0;height: 2rem;">
        <div class="col-100">
            我已阅读并同意《<a href="agreement.html" class="tjOnClick" tj-data="bbc_click_donate_userrules" external=""><span style="color:#0894ec;">用户协议</span></a>》
        </div>
    </div>
  </div>
</div>

</form><script>
function showInfo() {
  dialog = $.modal({
    text: '<div><img src="https://staticcdn2.zhongtuobang.com/img/bbc2/bbc2-lovePointInfo.png" width="100%"><div class="closeAlert" style="position: absolute;width: 100%;height: 2rem;bottom: 1.4rem"></div></div>',
  });
  if($(document).width()>=375){
    $('.modal').css({'margin-left':'-8rem','width':'16rem'})
  }
  $('.modal-inner').css({'padding':0,'background':'rgba(0,0,0,0)'});
  $('.modal-in').css('margin-top',' -200px;');
  $('.closeAlert').click(function(){
    $.closeModal(dialog);
  });
}

//爱心值基数
var baseLovePoint=0;
if(1==1){
  baseLovePoint=10
}
//初始爱心值
var lovePoint=30+baseLovePoint;
var pay_money = 30;
$("#lovePoint").html('您的爱心值将增加'+lovePoint+'分。\n'+'<a style="text-decoration:underline;color:rgb(53,160,251)" onclick="showInfo()">何为爱心值？</a>');
$("#val_other").keyup(function () {
  lovePoint=baseLovePoint+parseInt($(this).val());
  $("#lovePoint").html('您的爱心值将增加'+lovePoint+'分。\n'+'<a style="text-decoration:underline;color:rgb(53,160,251)" onclick="showInfo()">何为爱心值？</a>');
})


$('#btnComment').click(function(){
  if(pay_money<=0){
  $.toast("请输入正确捐助金额！");
    return false;
  }
  if(pay_money>2000){
  $.toast("最高一次捐助2000元,请重新输入！");
    return false;
  }
  $.toast('订单正在创建中，请等待！');
  $("#Comment_money").val(pay_money);

  $(this).closest('form').submit();

  }
);


function changeCur(id) {
  $.each($("input[name='rec_val']"), function (i, v) {
    $(this).removeClass("cur");
  })
  $("#Money").removeClass("cur");
  $("#" + id).addClass("cur");
  $("#val_other").val("");
  $("#lovePoint").html('您的爱心值将增加'+lovePoint+'分。\n'+'<a style="text-decoration:underline;color:rgb(53,160,251)" onclick="showInfo()">何为爱心值？</a>');
}
$(function () {
  //$.init();
});
</script>

<script type="text/javascript">
  $('#PingXXComment').on('click',function () {
    if(pay_money<=0){
      $.toast("请输入正确捐助金额！");
      return false;
    }
    if(pay_money>2000){
      $.toast("最高一次捐助2000元,请重新输入！");
      return false;
    }
    $("#Comment_money").val(pay_money);

//    $(this).attr("class","button button-fill button-light");
//    $('#btnComment').attr("class","button button-big button-fill button-round button-light");
    var params = {
      'bbcID':7910,
      'bbcComment':$('#Comment_comment').val(),
      'isAnonymous':$('#comment_isAnonymous').prop('checked'),
      'money':pay_money,
      'follow':$('#follow').prop('checked'),
      'donateSource':'',
      'PUID':'',
    };
    $.ajax({
      type:'POST',
      data:JSON.stringify(params),
      contentType:'application/json; charset=utf-8',
      dataType:'json',
      url:'/bbc/createOrder',
      success:function (result) {
        if(result.success == true){
          pingxxApiPay(result);
        }else{
          $.toast(result.message);
        }
      },
      error:function () {
        $.toast('网络连接失败，请重试！');
      }
    })
  });
  
  var pingxxApiPay = function (result) {
//    console.log(result.data);
    pingpp_one.init({
      app_id:'app_8u9O8OHOqvn5rrfn',//该应用在 ping++ 的应用 ID
      order_no:result.data.orderNo,//订单在商户系统中的订单号
      amount:result.data.money,//订单价格
		        channel:['wx_pub','alipay_wap'],
		        charge_url: 'https://bbc.zhongtuobang.com/pay/apiPaymentBbc',//商户服务端创建订单的 url
      charge_param:{
        bbcID:7910,
      },
      //open_id:'',//(可选，使用微信公众号支付时必须传入)
		      },function(res){
      //debug 模式下获取 charge_url 的返回结果
      if(res.debug&&res.chargeUrlOutput){
        console.log(res.chargeUrlOutput);
      }
      if(!res.status){
        //处理错误
        alert(res.msg);
      }else{
        //debug 模式下调用 charge_url 后会暂停，可以调用 pingpp_one.resume 方法继续执行
        if(res.debug&&!res.wxSuccess){
          if(confirm('当前为 debug 模式，是否继续支付？')){
            pingpp_one.resume();
          }
        }
        //若微信公众号渠道需要使用壹收款的支付成功页面，则在这里进行成功回调，
        //调用 pingpp_one.success 方法，你也可以自己定义回调函数
        //其他渠道的处理方法请见第 2 节
        else{
          location.href="/bbc/donateSuccess?id=7910&orderID="+result.data.orderID;
        }
      }
    });
  }

</script>
<script type="text/javascript" src="js/start/pingpp_one.js"></script>    </div>

    
<script type="text/javascript" src="js/start/sm.min.js"></script>
<script type="text/javascript" src="js/start/sm-extend.min.js"></script>

<iframe id="p_analyse_iframe" src="saved_resource.html" style="display: none;"></iframe></body></html>